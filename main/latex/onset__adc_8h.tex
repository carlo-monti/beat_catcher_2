\doxysection{onset\+\_\+adc.\+h File Reference}
\hypertarget{onset__adc_8h}{}\label{onset__adc_8h}\index{onset\_adc.h@{onset\_adc.h}}


ONSET\+\_\+\+ADC module handles the sampling of the piezo sensors and the onset detection. Basically, the module samples the analog input of Kick and Snare using the continuous adc mode. Given that the ADC on the ESP32 is known to be less than ideal, it performs an oversampling and an averaging. After that a very simple filter is applied to detect the amplitude envelope. The module, than, calculates the slope of the envelope and detects the onset. Whenever an onset is detected, its absolute position in time is stored in the onsets array.  


{\ttfamily \#include \"{}main\+\_\+defs.\+h\"{}}\newline
\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structonset__entry}{onset\+\_\+entry}}
\begin{DoxyCompactList}\small\item\em Struct of the onset log entry. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \mbox{\hyperlink{onset__adc_8h_ac8810a7a7425a6faee68a116b9587985}{onset\+\_\+adc\+\_\+queue\+\_\+msg}} \{ \mbox{\hyperlink{onset__adc_8h_ac8810a7a7425a6faee68a116b9587985a79b6eb96d45bda239b5e0e746ca976c6}{ONSET\+\_\+\+ADC\+\_\+\+ALLOW\+\_\+\+ONSET}}
, \mbox{\hyperlink{onset__adc_8h_ac8810a7a7425a6faee68a116b9587985a052282c13631a88927c0e11fab528ed6}{ONSET\+\_\+\+ADC\+\_\+\+DISALLOW\+\_\+\+ONSET}}
, \mbox{\hyperlink{onset__adc_8h_ac8810a7a7425a6faee68a116b9587985a55cf4f076513ee32e77b6e76d24e2ece}{ONSET\+\_\+\+ADC\+\_\+\+DISALLOW\+\_\+\+ONSET\+\_\+\+AND\+\_\+\+START\+\_\+\+SYNC}}
 \}
\begin{DoxyCompactList}\small\item\em Allowed messages for the onset\+\_\+adc queue. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{onset__adc_8h_a1cec65e2bd7258f1226270d37c755f05}{onset\+\_\+adc\+\_\+init}} ()
\begin{DoxyCompactList}\small\item\em Init function of the onset\+\_\+adc module. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
Queue\+Handle\+\_\+t \mbox{\hyperlink{onset__adc_8h_a96d4d597bf96e882dcb9103b8b1e3fe8}{onset\+\_\+adc\+\_\+task\+\_\+queue}}
\begin{DoxyCompactList}\small\item\em Queue to send msgs to the onset\+\_\+adc module. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
ONSET\+\_\+\+ADC module handles the sampling of the piezo sensors and the onset detection. Basically, the module samples the analog input of Kick and Snare using the continuous adc mode. Given that the ADC on the ESP32 is known to be less than ideal, it performs an oversampling and an averaging. After that a very simple filter is applied to detect the amplitude envelope. The module, than, calculates the slope of the envelope and detects the onset. Whenever an onset is detected, its absolute position in time is stored in the onsets array. 

The onset\+\_\+adc module has a queue that is used to ask the main task to start/stop logging onsets. 

\doxysubsection{Enumeration Type Documentation}
\Hypertarget{onset__adc_8h_ac8810a7a7425a6faee68a116b9587985}\label{onset__adc_8h_ac8810a7a7425a6faee68a116b9587985} 
\index{onset\_adc.h@{onset\_adc.h}!onset\_adc\_queue\_msg@{onset\_adc\_queue\_msg}}
\index{onset\_adc\_queue\_msg@{onset\_adc\_queue\_msg}!onset\_adc.h@{onset\_adc.h}}
\doxysubsubsection{\texorpdfstring{onset\_adc\_queue\_msg}{onset\_adc\_queue\_msg}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{onset__adc_8h_ac8810a7a7425a6faee68a116b9587985}{onset\+\_\+adc\+\_\+queue\+\_\+msg}}}



Allowed messages for the onset\+\_\+adc queue. 

Allowed messages for the onset\+\_\+adc queue. \begin{DoxyEnumFields}{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{ONSET\_ADC\_ALLOW\_ONSET@{ONSET\_ADC\_ALLOW\_ONSET}!onset\_adc.h@{onset\_adc.h}}\index{onset\_adc.h@{onset\_adc.h}!ONSET\_ADC\_ALLOW\_ONSET@{ONSET\_ADC\_ALLOW\_ONSET}}}\Hypertarget{onset__adc_8h_ac8810a7a7425a6faee68a116b9587985a79b6eb96d45bda239b5e0e746ca976c6}\label{onset__adc_8h_ac8810a7a7425a6faee68a116b9587985a79b6eb96d45bda239b5e0e746ca976c6} 
ONSET\+\_\+\+ADC\+\_\+\+ALLOW\+\_\+\+ONSET&The module starts logging onsets \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{ONSET\_ADC\_DISALLOW\_ONSET@{ONSET\_ADC\_DISALLOW\_ONSET}!onset\_adc.h@{onset\_adc.h}}\index{onset\_adc.h@{onset\_adc.h}!ONSET\_ADC\_DISALLOW\_ONSET@{ONSET\_ADC\_DISALLOW\_ONSET}}}\Hypertarget{onset__adc_8h_ac8810a7a7425a6faee68a116b9587985a052282c13631a88927c0e11fab528ed6}\label{onset__adc_8h_ac8810a7a7425a6faee68a116b9587985a052282c13631a88927c0e11fab528ed6} 
ONSET\+\_\+\+ADC\+\_\+\+DISALLOW\+\_\+\+ONSET&The module stops logging onsets \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{ONSET\_ADC\_DISALLOW\_ONSET\_AND\_START\_SYNC@{ONSET\_ADC\_DISALLOW\_ONSET\_AND\_START\_SYNC}!onset\_adc.h@{onset\_adc.h}}\index{onset\_adc.h@{onset\_adc.h}!ONSET\_ADC\_DISALLOW\_ONSET\_AND\_START\_SYNC@{ONSET\_ADC\_DISALLOW\_ONSET\_AND\_START\_SYNC}}}\Hypertarget{onset__adc_8h_ac8810a7a7425a6faee68a116b9587985a55cf4f076513ee32e77b6e76d24e2ece}\label{onset__adc_8h_ac8810a7a7425a6faee68a116b9587985a55cf4f076513ee32e77b6e76d24e2ece} 
ONSET\+\_\+\+ADC\+\_\+\+DISALLOW\+\_\+\+ONSET\+\_\+\+AND\+\_\+\+START\+\_\+\+SYNC&The module starts logging onsets and notifies sync to start evaluation \\
\hline

\end{DoxyEnumFields}


\doxysubsection{Function Documentation}
\Hypertarget{onset__adc_8h_a1cec65e2bd7258f1226270d37c755f05}\label{onset__adc_8h_a1cec65e2bd7258f1226270d37c755f05} 
\index{onset\_adc.h@{onset\_adc.h}!onset\_adc\_init@{onset\_adc\_init}}
\index{onset\_adc\_init@{onset\_adc\_init}!onset\_adc.h@{onset\_adc.h}}
\doxysubsubsection{\texorpdfstring{onset\_adc\_init()}{onset\_adc\_init()}}
{\footnotesize\ttfamily void onset\+\_\+adc\+\_\+init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Init function of the onset\+\_\+adc module. 

Init function of the onset\+\_\+adc module 

\doxysubsection{Variable Documentation}
\Hypertarget{onset__adc_8h_a96d4d597bf96e882dcb9103b8b1e3fe8}\label{onset__adc_8h_a96d4d597bf96e882dcb9103b8b1e3fe8} 
\index{onset\_adc.h@{onset\_adc.h}!onset\_adc\_task\_queue@{onset\_adc\_task\_queue}}
\index{onset\_adc\_task\_queue@{onset\_adc\_task\_queue}!onset\_adc.h@{onset\_adc.h}}
\doxysubsubsection{\texorpdfstring{onset\_adc\_task\_queue}{onset\_adc\_task\_queue}}
{\footnotesize\ttfamily Queue\+Handle\+\_\+t onset\+\_\+adc\+\_\+task\+\_\+queue\hspace{0.3cm}{\ttfamily [extern]}}



Queue to send msgs to the onset\+\_\+adc module. 

Queue to send msgs to the onset\+\_\+adc module. The allowed msg value are defined in onset\+\_\+adc\+\_\+queue\+\_\+msg enum.

queue of onset\+\_\+adc\+\_\+task 